!/bin/bash

THEME='\033[0;36m'
ERROR='\033[0;31m'
SUCCESS='\033[0;32m'
NEUTRAL='\033[0m'

pull=$1;
branch=$2;

space() { echo ""; echo ""; echo ""; echo ""; }

change_env() {
  sudo echo -e "export const environment = {\n  production: true,\n  backUrl: 'https://visio.fantasiapp.com:3440',\n};" > src/environments/environment.prod.ts;
  printf "${SUCCESS}"
  printf "%s\n" " _______  __    _  __   __  ___   ______    _______  __    _  __   __  _______  __    _  _______ ";
  printf "%s\n" "|       ||  |  | ||  | |  ||   | |    _ |  |       ||  |  | ||  |_|  ||       ||  |  | ||       |";
  printf "%s\n" "|    ___||   |_| ||  |_|  ||   | |   | ||  |   _   ||   |_| ||       ||    ___||   |_| ||_     _|";
  printf "%s\n" "|   |___ |       ||       ||   | |   |_||_ |  | |  ||       ||       ||   |___ |       |  |   |  ";
  printf "%s\n" "|    ___||  _    ||       ||   | |    __  ||  |_|  ||  _    ||       ||    ___||  _    |  |   |  ";
  printf "%s\n" "|   |___ | | |   | |     | |   | |   |  | ||       || | |   || ||_|| ||   |___ | | |   |  |   |  ";
  printf "%s\n" "|_______||_|  |__|  |___|  |___| |___|  |_||_______||_|  |__||_|   |_||_______||_|  |__|  |___|  ";
  printf "%s\n" " _______  __   __  _______  __    _  _______  _______  ______                                    ";
  printf "%s\n" "|       ||  | |  ||   _   ||  |  | ||       ||       ||      |                                   ";
  printf "%s\n" "|       ||  |_|  ||  |_|  ||   |_| ||    ___||    ___||  _    |                                  ";
  printf "%s\n" "|       ||       ||       ||       ||   | __ |   |___ | | |   |                                  ";
  printf "%s\n" "|      _||       ||       ||  _    ||   ||  ||    ___|| |_|   |                                  ";
  printf "%s\n" "|     |_ |   _   ||   _   || | |   ||   |_| ||   |___ |       |                                  ";
  printf "%s\n" "|_______||__| |__||__| |__||_|  |__||_______||_______||______|                                   ";
  printf "${NEUTRAL}"
}


present() {
  printf "${THEME}"
  printf "%s\n" " _______  _______  _______  ___   __   __  __    _  ___  ";
  printf "%s\n" "|  _    ||   _   ||       ||   | |  | |  ||  |  | ||   | ";
  printf "%s\n" "| |_|   ||  |_|  ||_     _||   | |  | |  ||   |_| ||   | ";
  printf "%s\n" "|       ||       |  |   |  |   | |  |_|  ||       ||   | ";
  printf "%s\n" "|  _   | |       |  |   |  |   | |       ||  _    ||   | ";
  printf "%s\n" "| |_|   ||   _   |  |   |  |   | |       || | |   ||   | ";
  printf "%s\n" "|_______||__| |__|  |___|  |___| |_______||_|  |__||___| ";
  printf "${NEUTRAL}"
}

build() {
  #git reset --hard HEAD
  #git checkout $branch
  echo " _______  __   __  ___   ___      ______   ___   __    _  _______ ";
  echo "|  _    ||  | |  ||   | |   |    |      | |   | |  |  | ||       |";
  echo "| |_|   ||  | |  ||   | |   |    |  _    ||   | |   |_| ||    ___|";
  echo "|       ||  |_|  ||   | |   |    | | |   ||   | |       ||   | __ ";
  echo "|  _   | |       ||   | |   |___ | |_|   ||   | |  _    ||   ||  |";
  echo "| |_|   ||       ||   | |       ||       ||   | | | |   ||   |_| |";
  echo "|_______||_______||___| |_______||______| |___| |_|  |__||_______|"; 
  space;

  #if [ "$pull" = "pull" ]; then
    #echo " __   __  _______  ___   __    _  _______    _______  ___   _______ ";
    #echo "|  | |  ||       ||   | |  |  | ||       |  |       ||   | |       |";
    #echo "|  | |  ||  _____||   | |   |_| ||    ___|  |    ___||   | |_     _|";
    #echo "|  |_|  || |_____ |   | |       ||   | __   |   | __ |   |   |   |  ";
    #echo "|       ||_____  ||   | |  _    ||   ||  |  |   ||  ||   |   |   |  ";
    #echo "|       | _____| ||   | | | |   ||   |_| |  |   |_| ||   |   |   |  ";
    #echo "|_______||_______||___| |_|  |__||_______|  |_______||___|   |___|  ";
    #git pull
  #fi;

  change_env;
  ng build --output-path dist;
  code=$?;

  if [ $code -ne 0 ]; then
    printf "${ERROR}"
    printf "%s\n" " _______  __   __  ___   ___      ______     _______  _______  ___   ___      _______  ______  ";
    printf "%s\n" "|  _    ||  | |  ||   | |   |    |      |   |       ||   _   ||   | |   |    |       ||      | ";
    printf "%s\n" "| |_|   ||  | |  ||   | |   |    |  _    |  |    ___||  |_|  ||   | |   |    |    ___||  _    |";
    printf "%s\n" "|       ||  |_|  ||   | |   |    | | |   |  |   |___ |       ||   | |   |    |   |___ | | |   |";
    printf "%s\n" "|  _   | |       ||   | |   |___ | |_|   |  |    ___||       ||   | |   |___ |    ___|| |_|   |";
    printf "%s\n" "| |_|   ||       ||   | |       ||       |  |   |    |   _   ||   | |       ||   |___ |       |";
    printf "%s\n" "|_______||_______||___| |_______||______|   |___|    |__| |__||___| |_______||_______||______| ";
    printf "${NEUTRAL}"
    exit $code;
  fi; 
}

sync() {
  echo " _______  __   __  __    _  _______  ___   __    _  _______ ";
  echo "|       ||  | |  ||  |  | ||       ||   | |  |  | ||       |";
  echo "|  _____||  |_|  ||   |_| ||       ||   | |   |_| ||    ___|";
  echo "| |_____ |       ||       ||       ||   | |       ||   | __ ";
  echo "|_____  ||_     _||  _    ||      _||   | |  _    ||   ||  |";
  echo " _____| |  |   |  | | |   ||     |_ |   | | | |   ||   |_| |";
  echo "|_______|  |___|  |_|  |__||_______||___| |_|  |__||_______|";
  space;

  npx cap sync;
  code=$?;

  if [ $code -ne 0 ]; then
    printf "${ERROR}"
    printf "%s\n" " _______  __   __  __    _  _______    _______  _______  ___   ___      _______  ______  ";
    printf "%s\n" "|       ||  | |  ||  |  | ||       |  |       ||   _   ||   | |   |    |       ||      | ";
    printf "%s\n" "|  _____||  |_|  ||   |_| ||       |  |    ___||  |_|  ||   | |   |    |    ___||  _    |";
    printf "%s\n" "| |_____ |       ||       ||       |  |   |___ |       ||   | |   |    |   |___ | | |   |";
    printf "%s\n" "|_____  ||_     _||  _    ||      _|  |    ___||       ||   | |   |___ |    ___|| |_|   |";
    printf "%s\n" " _____| |  |   |  | | |   ||     |_   |   |    |   _   ||   | |       ||   |___ |       |";
    printf "%s\n" "|_______|  |___|  |_|  |__||_______|  |___|    |__| |__||___| |_______||_______||______| ";    exit $?;
    printf "${NEUTRAL}"
    exit $code;
  fi;
}

link() {
  echo " ___      ___   __    _  ___   _  ___   __    _  _______ ";
  echo "|   |    |   | |  |  | ||   | | ||   | |  |  | ||       |";
  echo "|   |    |   | |   |_| ||   |_| ||   | |   |_| ||    ___|";
  echo "|   |    |   | |       ||      _||   | |       ||   | __ ";
  echo "|   |___ |   | |  _    ||     |_ |   | |  _    ||   ||  |";
  echo "|       ||   | | | |   ||    _  ||   | | | |   ||   |_| |";
  echo "|_______||___| |_|  |__||___| |_||___| |_|  |__||_______|";
  space;

  rm -rf  /var/fantasiapp/visio/front
  cp -r   /var/fantasiapp/visio/front-source/dist /var/fantasiapp/visio/front
  chgrp fantasiapp /var/fantasiapp/visio/front
  chown www-data /var/fantasiapp/visio/front
  chmod g+rwx /var/fantasiapp/visio/front
  code=$?;

  if [ $code -ne 0 ]; then
    printf "${ERROR}"
    printf "%s\n" " ___      ___   __    _  ___   _    _______  _______  ___   ___      _______  ______  ";
    printf "%s\n" "|   |    |   | |  |  | ||   | | |  |       ||   _   ||   | |   |    |       ||      | ";
    printf "%s\n" "|   |    |   | |   |_| ||   |_| |  |    ___||  |_|  ||   | |   |    |    ___||  _    |";
    printf "%s\n" "|   |    |   | |       ||      _|  |   |___ |       ||   | |   |    |   |___ | | |   |";
    printf "%s\n" "|   |___ |   | |  _    ||     |_   |    ___||       ||   | |   |___ |    ___|| |_|   |";
    printf "%s\n" "|       ||   | | | |   ||    _  |  |   |    |   _   ||   | |       ||   |___ |       |";
    printf "%s\n" "|_______||___| |_|  |__||___| |_|  |___|    |__| |__||___| |_______||_______||______| ";
    printf "${NEUTRAL}"
    exit $code;
  fi;
}

bye() {
  printf "${SUCCESS}"
  printf "%s\n" " ______   _______  __    _  _______    ___   ____   ";
  printf "%s\n" "|      | |       ||  |  | ||       |  |   | |    |  ";
  printf "%s\n" "|  _    ||   _   ||   |_| ||    ___|  |___| |_    | ";
  printf "%s\n" "| | |   ||  | |  ||       ||   |___    ___    |   | ";
  printf "%s\n" "| |_|   ||  |_|  ||  _    ||    ___|  |   |   |   | ";
  printf "%s\n" "|       ||       || | |   ||   |___   |___|  _|   | ";
  printf "%s\n" "|______| |_______||_|  |__||_______|        |____|  ";
  printf "${NEUTRAL}"
  exit 0;
}


present;
build;
sync;
link;
bye;
