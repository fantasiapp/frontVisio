<button class="close" (click)="requestQuit()">
    <img src="assets/X.svg"/>
</button>
<div class="nav">
    <ul #navigation>
        <li *ngFor="let page of pages; let index = index" [class.selected]="index == currentIndex" (click)="setPage(index)">{{page}}</li>
        <hr class="horizontal-line">
    </ul>
</div>

<ng-container *ngIf="pdv">
    <ng-container *ngIf="currentIndex == 0">
        <div class="main">
            <h2><span class="title">{{pages[currentIndex]}}: </span>{{pdv!.attribute('name')}}</h2>
            <div class="reference">
                <div class="definition">
                    <ul>
                        <li><span>Point de vente :</span> {{pdv!.attribute('name')}}</li>
                        <li><span>Agent :</span> {{getName('agent')}}</li>
                        <li><span>Segment :</span> {{getName('segmentMarketing')}}</li>
                        <li><span>Enseigne :</span> {{getName('enseigne')}}</li>
                        <li><span>Département :</span> {{getName('dep')}}</li>
                        <li><span>Ville :</span> {{getName('ville')}}</li>
                        <li><span>Bassin :</span> {{getName('bassin')}}</li>
                    </ul>
                </div>
                <div class="props">
                    <ul>
                        <li>
                            <label class="container-checkbox">
                                Ne vend pas de plaque
                                <input type="checkbox" [attr.checked]="pdv.attribute('target')[TARGET_SALE_ID]" disabled>
                                <span class="checkmark" ></span>
                            </label>
                        </li>
                        <li>
                            <label class="container-checkbox">
                                Point de vente redistribue
                                <input type="checkbox" [attr.checked]="redistributedChecked" (change)="changeRedistributed()" [disabled]="redistributedDisabled">
                                <span class="checkmark"></span>
                            </label>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="currentIndex == 1">
        <div class="main">
            <h2><span class="title">{{pages[currentIndex]}}: </span>{{pdv!.attribute('name')}}</h2>
            <!-- <p>information sur la point de vente</p> -->
            <div class="content">
                <div class="definition">
                    <div class="name">Général</div>
                    <ul>
                        <li><span>Agent : </span> {{getName('agent')}}</li>
                        <li><span>Enseigne : </span> {{getName('enseigne')}}</li>
                        <li><span>Départements : </span> {{getName('dep')}}</li>
                        <li><span>Client prospect : </span> {{pdv!.clientProspect() || "Non documenté"}} </li>
                        <li><span>Segmentation marketing : </span>{{getName('segmentMarketing')}}</li>
                        <li><span>Segmentation portefeuille : </span> {{getName('segmentCommercial')}} </li>
                    </ul>
                </div>

                <div class="definition" *ngIf="getSalesVolumes().length">
                    <div class="name">Volumes de vente par marque en m²</div>
                    <ul>
                        <li *ngFor="let entry of getSalesVolumes()"><span>{{entry[0]}} : </span>{{formatNumberToString(entry[1])}} m²</li>
                    </ul>
                </div>

                <div class="eval">
                    <ul>
                        <li><span class="bolder">Volume visé en m² :</span><input style="margin-left: 10px" [value]="target[TARGET_VOLUME_ID]" (change)="changeTargetP2CD(targetP2CD.value)" type="number" #targetP2CD agentOnly/></li>
                        <li><span class="bolder">Capacité à faire basculer le PDV :</span>
                            <button (click)="changeLight('r')" agentOnly><div class="circle" [ngStyle]="{'background': target[TARGET_LIGHT_ID] === 'r' ? 'red' : 'lightgray'}"></div></button>
                            <button (click)="changeLight('o')" agentOnly><div class="circle" [ngStyle]="{'background': target[TARGET_LIGHT_ID] === 'o' ? 'orange' : 'lightgray'}"></div></button>
                            <button (click)="changeLight('g')" agentOnly><div class="circle" [ngStyle]="{'background': target[TARGET_LIGHT_ID] === 'g' ? 'green' : 'lightgray'}"></div></button>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="comments">
                <span>Commentaires :</span>
                <textarea (change)="changeComment()" #comments agentOnly>{{ target ? target[TARGET_COMMENT_ID] : '' }}</textarea>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="currentIndex == 2">
        <div class="main">
            <h2><span class="title">{{pages[currentIndex]}}: </span>{{pdv!.attribute('name')}}</h2>
            <!-- <p>information sur la point de vente</p> -->
            <div *ngIf="errorAdInput" class="invalidValue">Veuillez entrer une valeur valide (nombre décimal xxx.xx)</div>
            <div class="content">
                <div class="grid">
                    <div class="first row">
                        <div class="first empty cell"></div>
                        <div class="cell" *ngFor="let product of products">
                            {{product | titlecase}}
                        </div>
                    </div>
                    <div class="total row">
                        <div class="first cell">Totaux</div>
                        <div class="cell" *ngFor="let product of products; let i = index">
                            <input type="text"[value]="gridFormatted[0][i]" [disabled]="true"/>
                        </div>
                    </div>
                    <div class="row" *ngFor="let industry of industries; let j = index">
                        <div class="first cell">{{industry | titlecase}}</div>
                        <div class="cell" *ngFor="let product of products; let i = index">
                            <input type="text" [(ngModel)]="gridFormatted[j+1][i]" (keyup)="onKey($event)" (change)="changeSales(j+1, i)" [disabled]="i == 3 || j == 0" [style.color]="salesColors[j]" accessControl agentOnly/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</ng-container>

<img class="navigateLeft" src="assets/arrow_left.svg" *ngIf="currentIndex > 0" (click)="setPage(currentIndex - 1)"/>
<img class="navigateRight" src="assets/arrow_right.svg" *ngIf="currentIndex < 2" (click)="setPage(currentIndex + 1)"/>

<div class="cover" [style.display]="opened ? 'block' : 'none'"></div>
<div class="quitbar-container" [style.display]="quiting ? 'block' : 'none'">
    <div class="quitbar">
        <h1>Souhaitez-vous mettre à jour les modifications</h1>
        <div class="button-container">
            <button class="negative button" (click)="quit(false)">Non, merci</button>
            <button class="positive button" (click)="quit(true)">Oui</button>
        </div>
    </div>
</div>
